import unittest

from TorrentPython.DHTExplorer import *

INFO_HASH = b'i\x9c\xda\x89Z\xf6\xfb\xd5\xa8\x17\xff\xf4\xfeo\xa8\xab\x87\xe3oH'

TEMP_ROUTING_TABLE = {}
TEMP_ROUTING_TABLE.update({b'h\x07\xc3\xb3\xa8\xf0Ri\xa0\xf8\xa9V@!T)\x8c.\xbeA': ('117.87.14.253', 12497), b'i\x8e\x92\xa9\x98\x8d\x88\xbe|\x95\x8dz\xb1\x95\x04\x14\xc9\xe0\xcd\xf1': ('93.209.38.250', 6889), b'iY\xfd\xb1\xe8\xfaO\xa2\xe6\xcf\xa7[\xba\x9a\xafC<\xa6\x19\xce': ('5.166.102.49', 35852), b'i\xe1\r=?\x96\xe8\x9em^\xe0\nh\xe9\x05\x85zp\x82\x08': ('89.34.30.9', 30552), b'i\x96\xb3\xc0P\x83\x0b\x17\xfcC\xc3\x10\x07EP\x18\x8c\xd1N\xd4': ('88.245.173.52', 46232), b'.\xc6\xa3\xcd\xfc\x9a\xaeV\xa3!\xecm0AuV*v\xc3\xb5': ('60.212.124.63', 16001), b'i[\x80*q\xfdF\xb1\xab\xbf\x0bE\xcc\x05\xd6\xf2\x18\xbezO': ('185.34.3.189', 32150), b'2\xf5NisQ\xffJ\xec)\xcd\xba\xab\xf2\xfb\xe3F|\xc2g': ('67.215.246.10', 6881), b'M\xfd\xb8v;s\xfe\xda#mb]oK)\xe7\xe3\x0c{\xce': ('213.138.182.81', 38153), b'h\xe6\xc2\x1e\xa8\xda\x04\xac\xc2(:\x1b\xb5*\xb5\x87\xf1\xaf\xdc\\': ('185.74.223.162', 9419), b'\xeb\xff6isQ\xffJ\xec)\xcd\xba\xab\xf2\xfb\xe3F|\xc2g': ('82.221.103.244', 6881), b'i\xc9\xffCm-6pU\xcc$\xb7Ht\x13\xd7\xe0X\xd2\x1e': ('37.208.103.231', 49001), b'i\x83N\x1c\xf0\xc0\xbfZ\x07I\xdc\xbc\xb6\xe5\xde\x93\xb1\x8f\x87\x84': ('46.109.21.58', 41797), b'(\xfd\x00\x9a.\xe6\x9d\xfc\\\xbe!svh[\xd70\xdaQ\x8c': ('104.54.89.97', 27765), b'i\x9f\xc1T\x9d)\xe1\xe4\x1e\x13f,\xb2\\\xd3X\x0c\x07n\x8c': ('133.130.58.215', 6802), b'i\x80d\x02W\xbc\xb1\xa9\x97\xc5\x1f\xae\xf9}\xc8n\x7fp-\xa1': ('185.34.3.137', 9628), b'<\xcew\x12k\x16bALc\xeb\x9b\x9f\x86j\xaa\x15~\xb0\x86': ('114.17.181.156', 17251), b'a\x82A\x11+/\\\x97P\xdaL9WB\xde]\x99\xa8h\xd3': ('90.154.65.88', 24342), b'p\xe4h9-XE)\xe3\xc3\xb8f;\xc8\x128\x0cS\x1eT': ('186.133.18.150', 15293), b'i\x96\xb9\xf0\xb2\xee\xdf\x8a\xc1f\xc6*&\xb0\xc4\xddC\xf0~\xae': ('124.148.234.113', 18059), b'h\xdd/YU\x7f7\xc4\xffZ\xb0e\xf2jT\xec\r\x07\xc3\xe6': ('50.23.239.8', 6904), b"I2'\xce\xed\x9d\xc5\x85p\x8f\xbd4\xab\xe4#gr\x9d/e": ('80.153.102.128', 6881), b'i\x91Q\x88z/]!a\xab\x9e\x84\xff\xb5\x14\xa7I\xff\xfbH': ('158.195.197.89', 16356)})
TEMP_ROUTING_TABLE.update({b'h\xdd/YU\x7f7\xc4\xffZ\xb0e\xf2jT\xec\r\x07\xc3\xe6': ('50.23.239.8', 6904), b'i\x96\xb9\xf0\xb2\xee\xdf\x8a\xc1f\xc6*&\xb0\xc4\xddC\xf0~\xae': ('124.148.234.113', 18059), b'i[\x80*q\xfdF\xb1\xab\xbf\x0bE\xcc\x05\xd6\xf2\x18\xbezO': ('185.34.3.189', 32150), b'i\\\x7f\xceX{\xf9<\xefN\xfd\xfc\x896\\\xd5Z\xee\xfa\xf4': ('187.170.233.165', 22165), b"I2'\xce\xed\x9d\xc5\x85p\x8f\xbd4\xab\xe4#gr\x9d/e": ('80.153.102.128', 6881), b'h\x07\xc3\xb3\xa8\xf0Ri\xa0\xf8\xa9V@!T)\x8c.\xbeA': ('117.87.14.253', 12497), b'h\xe6\xc2\x1e\xa8\xda\x04\xac\xc2(:\x1b\xb5*\xb5\x87\xf1\xaf\xdc\\': ('185.74.223.162', 9419), b'<\xcew\x12k\x16bALc\xeb\x9b\x9f\x86j\xaa\x15~\xb0\x86': ('114.17.181.156', 17251), b'\xeb\xff6isQ\xffJ\xec)\xcd\xba\xab\xf2\xfb\xe3F|\xc2g': ('82.221.103.244', 6881), b'i\x9f\xc1T\x9d)\xe1\xe4\x1e\x13f,\xb2\\\xd3X\x0c\x07n\x8c': ('133.130.58.215', 6802), b'i\x8f\xa5\x10\x0f\x88\xe5\xe3]\x07\xfd\x82\x99N+\xed5/\xfe\x86': ('45.55.214.219', 51413), b'iY\xfd\xb1\xe8\xfaO\xa2\xe6\xcf\xa7[\xba\x9a\xafC<\xa6\x19\xce': ('5.166.102.49', 35852), b'.\xc6\xa3\xcd\xfc\x9a\xaeV\xa3!\xecm0AuV*v\xc3\xb5': ('60.212.124.63', 16001), b'i\xe1\r=?\x96\xe8\x9em^\xe0\nh\xe9\x05\x85zp\x82\x08': ('89.34.30.9', 30552), b'i\xd9=\xfaa\xc3\xddx\x18\xf9m\x93\xab\xec\x8e\xe5\xea\xc0tB': ('60.28.235.76', 11101), b'i\x83N\x1c\xf0\xc0\xbfZ\x07I\xdc\xbc\xb6\xe5\xde\x93\xb1\x8f\x87\x84': ('46.109.21.58', 41797), b'i\\\xe8;\x85\x1b|\x05\x16\x94\x1b\xa7%\x11\xef\xeb*\xc0\xea\xc9': ('2.108.148.56', 51413), b'i\xee;\xc0\xce\xf1\x8e\xa0>\x1f\xaf\x00C\x90\x8f}\xf0\x92Wp': ('98.209.61.179', 51413), b'i\x8e\x92\xa9\x98\x8d\x88\xbe|\x95\x8dz\xb1\x95\x04\x14\xc9\xe0\xcd\xf1': ('93.209.38.250', 6889), b'a\x82A\x11+/\\\x97P\xdaL9WB\xde]\x99\xa8h\xd3': ('90.154.65.88', 24342), b'2\xf5NisQ\xffJ\xec)\xcd\xba\xab\xf2\xfb\xe3F|\xc2g': ('67.215.246.10', 6881), b'i\x96\xb3\xc0P\x83\x0b\x17\xfcC\xc3\x10\x07EP\x18\x8c\xd1N\xd4': ('88.245.173.52', 46232), b'i\x80d\x02W\xbc\xb1\xa9\x97\xc5\x1f\xae\xf9}\xc8n\x7fp-\xa1': ('185.34.3.137', 9628), b'i\xc9\xffCm-6pU\xcc$\xb7Ht\x13\xd7\xe0X\xd2\x1e': ('37.208.103.231', 49001), b'p\xe4h9-XE)\xe3\xc3\xb8f;\xc8\x128\x0cS\x1eT': ('186.133.18.150', 15293), b'i\\\xbf\x05\x95d\xd8\xd1@\xbfO\x03\nY\x06\x1b\xb4\x1f\xb8\xfb': ('71.199.69.54', 52871), b'i\xf6\xde~?{\xf9\xdbU\xf8\x8aP\xbf\xa0"!\xbf~)3': ('95.39.237.39', 56127), b'(\xfd\x00\x9a.\xe6\x9d\xfc\\\xbe!svh[\xd70\xdaQ\x8c': ('104.54.89.97', 27765), b'i\x91Q\x88z/]!a\xab\x9e\x84\xff\xb5\x14\xa7I\xff\xfbH': ('158.195.197.89', 16356), b'M\xfd\xb8v;s\xfe\xda#mb]oK)\xe7\xe3\x0c{\xce': ('213.138.182.81', 38153)})


class DHTExplorerTest(unittest.TestCase):
    def setUp(self):
        self.routingTable = dict(DHTExplorer.INITIAL_ROUTING_TABLE)
        self.routingTable.update(TEMP_ROUTING_TABLE)
        pass

    def tearDown(self):
        pass

    # @unittest.skip("wait")
    def test_findPeers(self):
        DHTService.TIMEOUT_SEC = 0.5  # sec

        service = DHTService()
        peers, routingTable = DHTExplorer.findPeers(service, self.routingTable, INFO_HASH)
        self.assertTrue(len(peers) > 0)
        self.assertTrue(len(routingTable) > 0)

        print(peers)
        print(routingTable)

        pass

    @unittest.skip("clear")
    def test_findPeersFromRoutingTable(self):
        service = DHTService()
        peers, routingTable = DHTExplorer.findPeersFromRoutingTable(
            service, self.routingTable, INFO_HASH,
            DHTExplorer.generatePeerLimitChecker(20),
            DHTExplorer.generateTimeLimitChecker(0))

        self.assertTrue(len(routingTable) > 0)
        print('peers : ', peers)
        print('routingTable : ', routingTable)

if __name__ == '__main__':
    unittest.main()
